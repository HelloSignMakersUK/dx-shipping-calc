
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DX Shipping Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .parcel-group { margin-bottom: 10px; }
    .parcel-group input { width: 80px; margin-right: 5px; }
    #result { white-space: pre-wrap; margin-top: 20px; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>DX Shipping Calculator</h2>

  <div id="parcels"></div>
  <button onclick="addParcel()">Add Parcel</button>

  <div>
    <label>Destination Postcode: <input id="postcode" required></label><br><br>
    <label>Fuel Surcharge (%): <input id="fuel" type="number" value="13.95" required></label><br><br>
    <label>Courier Email: <input id="email" value="Jackie.Kingman@dxdelivery.com; Nick.Scott@dxdelivery.com; Tasha.Joyce@dxdelivery.com; Brendon.Bridge@dxdelivery.com; Richard.Flambard@dxdelivery.com; Depot18@dxdelivery.com"></label><br><br>
    <label>CC: <input id="cc" value="hello@signmakersuk.com"></label><br><br>
    <button onclick="calculateShipping()">Calculate Shipping</button>
    <button onclick="sendEmail()">Send Collection Request</button>
    <p class="error" id="error"></p>
  </div>

  <div id="result"></div>

  <p><strong>Instructions:</strong></p>
  <ul>
    <li>Measure and weigh each parcel. Fill in the information above (fuel surcharge currently 13.95% as of 20/06/2025).</li>
    <li>Log into <a href="https://dm6.dxfreight.co.uk/logon/logon.aspx" target="_blank">Dispatch Manager 6 Light</a> with:
      <ul>
        <li>Depot: 95</li>
        <li>Account No.: 93022848</li>
        <li>Password: b25i3c</li>
      </ul>
    </li>
    <li>Follow consignment entry instructions.</li>
    <li>Once all parcels are done for the day, print 2 copies of the manifest for the driver.</li>
    <li><strong>Same day collection cut-off is 11am. Collections occur between 2–3pm.</strong></li>
  </ul>

  <script>
  window.onload = function () {
    function addParcel() {
      const parcelContainer = document.getElementById('parcels');
      const parcelDiv = document.createElement('div');
      parcelDiv.className = 'parcel-group';
      parcelDiv.innerHTML = `
        <label></label>
        Weight (kg): <input type="number" class="weight" step="0.01" required>
        Length (cm): <input type="number" class="length" step="0.1" required>
        Width (cm): <input type="number" class="width" step="0.1" required>
        Height (cm): <input type="number" class="height" step="0.1" required>
        <button onclick="removeParcel(this)">Remove</button>
      `;
      parcelContainer.appendChild(parcelDiv);
      renumberParcels();
    }

    function removeParcel(button) {
      button.parentElement.remove();
      renumberParcels();
    }

    function renumberParcels() {
      const parcelGroups = document.querySelectorAll('.parcel-group');
      parcelGroups.forEach((group, index) => {
        const label = group.querySelector('label');
        label.textContent = `Parcel ${index + 1}`;
      });
    }

    function calculateShipping() {
      const weights = [...document.querySelectorAll('.weight')].map(i => parseFloat(i.value) || 0);
      const lengths = [...document.querySelectorAll('.length')].map(i => parseFloat(i.value) || 0);
      const widths = [...document.querySelectorAll('.width')].map(i => parseFloat(i.value) || 0);
      const heights = [...document.querySelectorAll('.height')].map(i => parseFloat(i.value) || 0);
      const postcode = document.getElementById('postcode').value.trim();
      const fuelSurcharge = parseFloat(document.getElementById('fuel').value) || 0;

      if (!postcode || weights.includes(0) || lengths.includes(0) || widths.includes(0) || heights.includes(0)) {
        document.getElementById('error').textContent = 'Please complete all parcel dimensions and postcode.';
        document.getElementById('result').textContent = '';
        return;
      }

      document.getElementById('error').textContent = '';

      let totalCost = 0;
      let totalWeight = 0;
      const baseRate = 10.00;
      const geoSurcharge = postcode.startsWith('BT') ? 7.20 : 0;

      for (let i = 0; i < weights.length; i++) {
        const deadWeight = weights[i];
        const volWeight = (lengths[i] * widths[i] * heights[i]) / 5000;
        const billableWeight = Math.max(deadWeight, volWeight);
        totalWeight += billableWeight;
      }

      if (totalWeight <= 20) {
        totalCost = baseRate + geoSurcharge;
      } else {
        totalCost = (totalWeight * 0.55) + geoSurcharge;
      }

      const fuelCharge = totalCost * (fuelSurcharge / 100);
      const totalWithFuel = totalCost + fuelCharge;
      const vat = totalWithFuel * 0.2;
      const totalWithVat = totalWithFuel + vat;

      const region = geoSurcharge > 0 ? `Northern Ireland (+£${geoSurcharge.toFixed(2)})` : 'UK Mainland';

      document.getElementById('result').innerHTML = 
        `Region: ${region}
Base + Weight Cost: £${totalCost.toFixed(2)}
Fuel Surcharge: £${fuelCharge.toFixed(2)}
Total (ex VAT): £${totalWithFuel.toFixed(2)}
Total (inc VAT): £${totalWithVat.toFixed(2)}`;
    }

    function sendEmail() {
      const to = document.getElementById('email').value;
      const cc = document.getElementById('cc').value;
      const result = document.getElementById('result').textContent || '';
      const postcode = document.getElementById('postcode').value.trim();

      const weights = [...document.querySelectorAll('.weight')].map(i => parseFloat(i.value) || 0);
      const lengths = [...document.querySelectorAll('.length')].map(i => parseFloat(i.value) || 0);
      const widths = [...document.querySelectorAll('.width')].map(i => parseFloat(i.value) || 0);
      const heights = [...document.querySelectorAll('.height')].map(i => parseFloat(i.value) || 0);

      if (!to || !postcode || result === '' || weights.includes(0) || lengths.includes(0) || widths.includes(0) || heights.includes(0)) {
        alert('Please complete all fields and calculate shipping before sending email.');
        return;
      }

      let parcelDetails = '';
      for (let i = 0; i < weights.length; i++) {
        parcelDetails += `- Parcel ${i + 1}: Weight: ${weights[i]}kg, Dimensions: ${lengths[i]}x${widths[i]}x${heights[i]}cm
`;
      }

      const subject = encodeURIComponent('DX Collection Request');
      const body = encodeURIComponent(
        `Hi all,

` +
        `Please arrange a collection for the following parcels:

` +
        `${parcelDetails}
` +
        `Total number of parcels: ${weights.length}
` +
        `Destination postcode: ${postcode}

` +
        `Manifest summary and cost breakdown:
${result}

` +
        `Many thanks,
Sign Makers UK`
      );

      window.location.href = `mailto:${to}?cc=${cc}&subject=${subject}&body=${body}`;
    }

    window.addParcel = addParcel;
    window.calculateShipping = calculateShipping;
    window.sendEmail = sendEmail;
    window.removeParcel = removeParcel;

    addParcel();
  };
  </script>
</body>
</html>

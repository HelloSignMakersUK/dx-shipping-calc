<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DX Shipping Cost Estimator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input[type="text"], input[type="number"], input[type="email"] {
      padding: 5px; margin-bottom: 5px; width: 100px; margin-right: 5px;
    }
    .parcel-group { display: flex; align-items: center; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    .parcel-group label { width: 100%; margin-bottom: 0; font-weight: bold; }
    button { margin-top: 10px; margin-right: 5px; padding: 6px 12px; font-size: 14px; }
    .result { margin-top: 20px; font-weight: bold; white-space: pre-line; }
    .cutoff-warning { color: red; font-weight: bold; margin-top: 10px; }
    .error { color: red; font-weight: bold; }
    .instructions { margin-top: 30px; font-size: 14px; line-height: 1.6; border-top: 1px solid #aaa; padding-top: 20px; }
    .instructions h2 { font-size: 16px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>DX Shipping Cost Estimator</h1>

  <label for="postcode">Destination Postcode:</label>
  <input type="text" id="postcode" placeholder="e.g. BT5">

  <label for="fuel">Fuel Surcharge (%):</label>
  <input type="number" id="fuel" placeholder="e.g. 8.95" step="0.01">

  <div id="parcels"></div>
  <button onclick="addParcel()">Add Parcel</button>
  <button onclick="calculateShipping()">Calculate Shipping</button>

  <div class="result" id="result"></div>
  <div class="error" id="error"></div>

  <label for="email">Courier Email Address (To):</label>
  <input type="text" id="email" style="width: 100%;" value="Jackie.Kingman@dxdelivery.com; Nick.Scott@dxdelivery.com; Tasha.Joyce@dxdelivery.com; Brendon.Bridge@dxdelivery.com; Richard.Flambard@dxdelivery.com; Depot18@dxdelivery.com">

  <label for="cc">CC:</label>
  <input type="text" id="cc" style="width: 100%;" value="hello@signmakersuk.com">
  <button onclick="sendEmail()">Send Collection Request</button>

  <div id="cutoffMessage" class="cutoff-warning"></div>

  <div class="instructions">
    <h2>How to Order</h2>
    <p><strong>Note:</strong> Same day delivery cut-off is <strong>11:00 AM</strong>. Collections take place between <strong>2:00 PM and 3:00 PM</strong>.</p>
    <ol>
      <li>Measure and weigh each parcel accurately.</li>
      <li>Fill out the shipping details above.</li>
      <li>Fuel surcharge information can be found on your DX paperwork (currently <strong>13.95%</strong> as of <strong>20/06/2025</strong>).</li>
      <li>Log in to <a href="https://dm6.dxfreight.co.uk/logon/logon.aspx" target="_blank">DX Freight Portal</a> using:<br>
        Depot: <strong>95</strong><br>Account No.: <strong>93022848</strong><br>Password: <strong>b25i3c</strong><br>Use <strong>Dispatch Manager 6 Light</strong> and follow the consignment entry instructions.
      </li>
      <li>Produce a consignment for each parcel/destination.</li>
      <li>Once all parcels are completed for the day, print <strong>2 copies</strong> of the manifest for the driver.</li>
      <li>When sending the collection request, email all of the following:
        <ul>
          <li>Jackie Kingman &lt;<a href="mailto:Jackie.Kingman@dxdelivery.com">Jackie.Kingman@dxdelivery.com</a>&gt;</li>
          <li>Nick Scott &lt;<a href="mailto:Nick.Scott@dxdelivery.com">Nick.Scott@dxdelivery.com</a>&gt;</li>
          <li>Tasha Joyce &lt;<a href="mailto:Tasha.Joyce@dxdelivery.com">Tasha.Joyce@dxdelivery.com</a>&gt;</li>
          <li>Brendon Bridge &lt;<a href="mailto:Brendon.Bridge@dxdelivery.com">Brendon.Bridge@dxdelivery.com</a>&gt;</li>
          <li>Richard Flambard &lt;<a href="mailto:Richard.Flambard@dxdelivery.com">Richard.Flambard@dxdelivery.com</a>&gt;</li>
          <li>Depot 18 &lt;<a href="mailto:Depot18@dxdelivery.com">Depot18@dxdelivery.com</a>&gt;</li>
        </ul>
        <strong>CC:</strong> <a href="mailto:hello@signmakersuk.com">hello@signmakersuk.com</a>
      </li>
    </ol>
  </div>

  <script>
window.onload = function () {
  function addParcel() {
    const parcelContainer = document.getElementById('parcels');
    const parcelDiv = document.createElement('div');
    parcelDiv.className = 'parcel-group';
    parcelDiv.innerHTML = `
      <label></label>
      Weight (kg): <input type="number" class="weight" step="0.01" required>
      Length (cm): <input type="number" class="length" step="0.1" required>
      Width (cm): <input type="number" class="width" step="0.1" required>
      Height (cm): <input type="number" class="height" step="0.1" required>
      <button onclick="removeParcel(this)">Remove</button>
    `;
    parcelContainer.appendChild(parcelDiv);
    renumberParcels();
  }

  function removeParcel(button) {
    button.parentElement.remove();
    renumberParcels();
  }

  function renumberParcels() {
    const parcelGroups = document.querySelectorAll('.parcel-group');
    parcelGroups.forEach((group, index) => {
      const label = group.querySelector('label');
      label.textContent = `Parcel ${index + 1}`;
    });
  }

  function calculateShipping() {
    const weights = [...document.querySelectorAll('.weight')].map(i => parseFloat(i.value) || 0);
    const lengths = [...document.querySelectorAll('.length')].map(i => parseFloat(i.value) || 0);
    const widths = [...document.querySelectorAll('.width')].map(i => parseFloat(i.value) || 0);
    const heights = [...document.querySelectorAll('.height')].map(i => parseFloat(i.value) || 0);
    const postcode = document.getElementById('postcode').value.trim();
    const fuelSurcharge = parseFloat(document.getElementById('fuel').value) || 0;

    if (!postcode || weights.includes(0) || lengths.includes(0) || widths.includes(0) || heights.includes(0)) {
      document.getElementById('error').textContent = 'Please complete all parcel dimensions and postcode.';
      document.getElementById('result').textContent = '';
      return;
    }

    document.getElementById('error').textContent = '';

    let totalCost = 0;
    let totalWeight = 0;
    const baseRate = 10.00;
    const geoSurcharge = postcode.startsWith('BT') ? 7.20 : 0;

    for (let i = 0; i < weights.length; i++) {
      const deadWeight = weights[i];
      const volWeight = (lengths[i] * widths[i] * heights[i]) / 5000;
      const billableWeight = Math.max(deadWeight, volWeight);
      totalWeight += billableWeight;
    }

    if (totalWeight <= 20) {
      totalCost = baseRate + geoSurcharge;
    } else {
      totalCost = (totalWeight * 0.55) + geoSurcharge;
    }

    const fuelCharge = totalCost * (fuelSurcharge / 100);
    const totalWithFuel = totalCost + fuelCharge;
    const vat = totalWithFuel * 0.2;
    const totalWithVat = totalWithFuel + vat;

    const region = geoSurcharge > 0 ? `Northern Ireland (+£${geoSurcharge.toFixed(2)})` : 'UK Mainland';

    document.getElementById('result').innerHTML = 
      `Region: ${region}
Base + Weight Cost: £${totalCost.toFixed(2)}
Fuel Surcharge: £${fuelCharge.toFixed(2)}
Total (ex VAT): £${totalWithFuel.toFixed(2)}
Total (inc VAT): £${totalWithVat.toFixed(2)}`;
  }

  function sendEmail() {
  const to = document.getElementById('email').value;
  const cc = document.getElementById('cc').value;
  const result = document.getElementById('result').textContent || '';
  const postcode = document.getElementById('postcode').value.trim();

  const weights = [...document.querySelectorAll('.weight')].map(i => parseFloat(i.value) || 0);
  const lengths = [...document.querySelectorAll('.length')].map(i => parseFloat(i.value) || 0);
  const widths = [...document.querySelectorAll('.width')].map(i => parseFloat(i.value) || 0);
  const heights = [...document.querySelectorAll('.height')].map(i => parseFloat(i.value) || 0);

  if (!to || !postcode || result === '' || weights.includes(0) || lengths.includes(0) || widths.includes(0) || heights.includes(0)) {
    alert('Please complete all fields and calculate shipping before sending email.');
    return;
  }

  let parcelDetails = '';
  for (let i = 0; i < weights.length; i++) {
    parcelDetails += `- Parcel ${i + 1}: Weight: ${weights[i]}kg, Dimensions: ${lengths[i]}x${widths[i]}x${heights[i]}cm\n`;
  }

  const subject = encodeURIComponent('DX Collection Request');
  const body = encodeURIComponent(
    `Hi all,\n\n` +
    `Please arrange a collection for the following parcels:\n\n` +
    `${parcelDetails}\n` +
    `Total number of parcels: ${weights.length}\n` +
    `Destination postcode: ${postcode}\n\n` +
    `Manifest summary and cost breakdown:\n${result}\n\n` +
    `Many thanks,\nSign Makers UK`
  );

  window.location.href = `mailto:${to}?cc=${cc}&subject=${subject}&body=${body}`;
}

    const subject = encodeURIComponent('DX Collection Request');
    const body = encodeURIComponent(`Please arrange a collection for parcels going to postcode ${postcode}.

Details:
${result}`);

    window.location.href = `mailto:${to}?cc=${cc}&subject=${subject}&body=${body}`;
  }

  window.addParcel = addParcel;
  window.calculateShipping = calculateShipping;
  window.sendEmail = sendEmail;
  window.removeParcel = removeParcel;

  addParcel();
};
</script>
</body>
</html>
